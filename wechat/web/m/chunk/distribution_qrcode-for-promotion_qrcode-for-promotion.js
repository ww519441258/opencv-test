(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{"241":function(e,t,o){"use strict";o.d(t,"a",function(){return d});var n,r,i=o(1),a=o(2),c=o(51),s=o(10),l=o.n(s),p=o(240),u=o.n(p),f=(o(242),function(){function defineProperties(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,o){return t&&defineProperties(e.prototype,t),o&&defineProperties(e,o),e}}());var d=(r=n=function(e){function loading(e){!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,loading);var t=function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(loading.__proto__||Object.getPrototypeOf(loading)).call(this,e));return t.state={},t}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{"constructor":{"value":e,"enumerable":!1,"writable":!0,"configurable":!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(loading,a["a"].Component),f(loading,[{"key":"render","value":function render(){var e=this.props,t=e.type,o=e.display,n=e.tipText,r=l()("loading",t,o);return i.k.createElement(c.a,{"className":r},i.k.createElement(c.a,{"className":"circle"}),i.k.createElement(c.a,{"className":"text"},n,"..."))}}]),loading}(),n.options={"addGlobalClass":!0},n.propTypes={"type":u.a.oneOf(["center","block","inline"]),"display":u.a.oneOf(["dark","light"]),"tipText":u.a.string},n.defaultProps={"type":"center","display":"dark","tipText":"加载中"},r)},"242":function(e,t,o){},"292":function(e,t,o){"use strict";o.d(t,"a",function(){return d});var n,r,i=o(1),a=o(2),c=o(51),s=o(240),l=o.n(s),p=o(10),u=o.n(p),f=(o(293),function(){function defineProperties(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,o){return t&&defineProperties(e.prototype,t),o&&defineProperties(e,o),e}}());var d=(r=n=function(e){function Popup(e){!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Popup);var t=function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(Popup.__proto__||Object.getPrototypeOf(Popup)).call(this,e));return t.state={},t}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{"constructor":{"value":e,"enumerable":!1,"writable":!0,"configurable":!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(Popup,a["a"].Component),f(Popup,[{"key":"render","value":function render(){var e=this.props,t=e.isShow,o=e.cannontClose,n=e.autoWidth,r=e.onHide,a=void 0;return t&&(a=i.k.createElement(c.a,null,i.k.createElement(c.a,{"className":"shade","onClick":r}),i.k.createElement(c.a,{"className":u()("popup-modal",{"auto-width":n})},this.props.children),!o&&i.k.createElement(c.a,{"className":"iconfont icon-close","onClick":r}))),i.k.createElement(c.a,{"className":"popup"},a)}}]),Popup}(),n.options={"addGlobalClass":!0},n.defaultProps={"isShow":!1,"cannotClose":!1,"autoWidth":!1,"onHide":function onHide(){}},n.propTypes={"isShow":l.a.bool,"cannotClose":l.a.bool,"autoWidth":l.a.bool,"onHide":l.a.func},r)},"293":function(e,t,o){},"431":function(e,t,o){},"509":function(e,t,o){"use strict";o.r(t),o.d(t,"default",function(){return S});var n=o(1),r=o(510),i=o(511),a=o(512),c=o(236),s=o(513),l=o(2),p=o(237),u=o(51),f=o(288),d=o(543),h=o(258),m=o(259),y=o(327),b=o(260),g=(o(431),o(77)),P=o(241),w=o(292),v=o(3),_=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function sliceIterator(e,t){var o=[],n=!0,r=!1,i=void 0;try{for(var a,c=e[Symbol.iterator]();!(n=(a=c.next()).done)&&(o.push(a.value),!t||o.length!==t);n=!0);}catch(e){r=!0,i=e}finally{try{!n&&c.return&&c.return()}finally{if(r)throw i}}return o}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),O=function(){function defineProperties(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,o){return t&&defineProperties(e.prototype,t),o&&defineProperties(e,o),e}}(),k=function get(e,t,o){null===e&&(e=Function.prototype);var n=Object.getOwnPropertyDescriptor(e,t);if(void 0===n){var r=Object.getPrototypeOf(e);return null===r?void 0:get(r,t,o)}if("value"in n)return n.value;var i=n.get;return void 0!==i?i.call(o):void 0};function _defineProperty(e,t,o){return t in e?Object.defineProperty(e,t,{"value":o,"enumerable":!0,"configurable":!0,"writable":!0}):e[t]=o,e}var E=void 0;try{E=Object(r.a)()||{"pixelRatio":1}}catch(e){E={"pixelRatio":1}}var j=E.windowWidth,C=750/(void 0===j?1080:j),S=function(e){function QrcodeForPromotion(e){!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,QrcodeForPromotion);var t=function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(QrcodeForPromotion.__proto__||Object.getPrototypeOf(QrcodeForPromotion)).call(this,e));return t.config={"navigationBarTitleText":"推广二维码"},t.showTip=function(){t.setState({"isShowTip":!0})},t.hideTip=function(){t.setState({"isShowTip":!1})},t.displayPoster=function(e,o){if(e&&e.qrcode&&o&&o.imageUrl){var n=o.imageUrl,r=o.refWidth,a=o.refHeight,c=e&&(e.qrcode&&e.qrcode.qrcode||e.qrcode),s=Object(i.a)({"url":n}),l=Object(i.a)({"url":c});Promise.all([s,l]).then(function(e){var n=_(e,2),i=n[0],c=n[1];t.imageBackground=i.tempFilePath,t.imageQRCode=c.tempFilePath;var s=o&&o.exportHeight/o.exportWidth,l=400/r/C,p=(s&&400*s)/a/C;t.drawPoster("spread-poster",o,l,p)}).catch(function(e){Object(v.a)(e.errMsg||JSON.stringify(e)),t.setState({"isDownloadingQRCode":!1})})}else Object(v.a)("数据异常")},t.drawPoster=function(e){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.state.layout,n=arguments[2],r=arguments[3],i=o.qrCodePos,c=o.qrCodeSize,s=o.refWidth,l=o.refHeight,p=Object(a.a)(e,t);return p.scale(n,r),p.drawImage(t.imageBackground,0,0,s,l),p.drawImage(t.imageQRCode,i.x,i.y,c,c),new Promise(function(t){p.draw(!1,function(){t(e)})})},t.downloadImage=function(e){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"isDownloadingPoster";Object(c.f)({"filePath":e,"success":function success(){Object(v.c)("保存成功"),t.setState(_defineProperty({},o,!1))},"fail":function fail(e){"saveImageToPhotosAlbum:fail cancel"===e.errMsg?Object(v.b)("取消保存"):Object(v.a)(e.errMsg||JSON.stringify(e)),t.setState(_defineProperty({},o,!1))}})},t.downloadPoster=function(){t.setState({"isDownloadingPoster":!0});var e=t.state.layout,o=e.exportWidth,n=e.exportHeight,r=e.refWidth,i=e.refHeight;t.drawPoster("spread-poster-export",void 0,o/r,n/i).then(function(e){Object(s.a)({"canvasId":e,"quality":1,"destWidth":o,"destHeight":n,"success":function success(e){t.downloadImage(e.tempFilePath,"isDownloadingPoster")},"fail":function fail(e){Object(v.a)(e.errMsg||JSON.stringify(e)),t.setState({"isDownloadingPoster":!1})}},t)})},t.downloadQrCode=function(){t.setState({"isDownloadingQRCode":!0});var e=t.state.info,o=e&&(e.qrcode&&e.qrcode.qrcode||e.qrcode);Object(i.a)({"url":o,"success":function success(e){t.downloadImage(e.tempFilePath,"isDownloadingQRCode")},"fail":function fail(e){Object(v.a)(e.errMsg||JSON.stringify(e)),t.setState({"isDownloadingQRCode":!1})}})},t.state={"info":null,"layout":null,"isShowTip":!1,"loadingPoster":!0,"isDownloadingPoster":!1,"isDownloadingQRCode":!1,"explain":""},t}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{"constructor":{"value":e,"enumerable":!1,"writable":!0,"configurable":!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(QrcodeForPromotion,l["a"].Component),O(QrcodeForPromotion,[{"key":"componentWillMount","value":function componentWillMount(){var e=this,t=Object(g.b)({"name":"getQrCodeForPromotion","data":{"type":"WEB"===l.a.getEnv()?1:2},"success":function success(t){e.setState({"info":t})}}),o=Object(g.b)({"name":"getSpreadPosterForDistribution","success":function success(t){e.setState({"layout":t})}});Object(g.b)({"name":"getCommissionExplain","success":function success(t){e.setState({"explain":t.illustration})}}),Promise.all([t,o]).then(function(t){var o=_(t,2),n=o[0],r=o[1];Object(p.a)(),e.setState({"loadingPoster":!1},function(){e.displayPoster(n,r)})})}},{"key":"onShareAppMessage","value":function onShareAppMessage(){}},{"key":"onPullDownRefresh","value":function onPullDownRefresh(){this.componentWillMount()}},{"key":"render","value":function render(){var e=this,t=this.state,o=t.explain,r=t.layout,i=t.loadingPoster,a=t.isDownloadingPoster,c=t.isDownloadingQRCode,s=r&&r.exportHeight/r.exportWidth,l=s&&400*s,p=n.k.createElement(u.a,{"className":"qrcode-for-promotion"},n.k.createElement(u.a,{"className":"background"},n.k.createElement(u.a,{"className":"main"},n.k.createElement(u.a,{"className":"user-info"},n.k.createElement(u.a,{"className":"avatar"},n.k.createElement(f.a,{"type":"userAvatarUrl"})),n.k.createElement(u.a,{"className":"nick-name"},n.k.createElement(f.a,{"type":"userNickName"}))),i?n.k.createElement(P.a,{"type":"inline"}):n.k.createElement(u.a,{"className":"poster"},n.k.createElement(u.a,{"className":"canvas-wrapper"},n.k.createElement(d.a,{"canvasId":"spread-poster","style":{"width":"400rpx","height":l+"rpx"},"ref":function ref(t){!function(t){e["__taroref_spread-poster"]=t}(t),e["__taroref_spread-poster"]=t}}),n.k.createElement(d.a,{"canvasId":"spread-poster-export","style":{"position":"absolute","bottom":r.exportHeight+1e3+"px","width":r.exportWidth+"px","height":r.exportHeight+"px"},"ref":function ref(t){!function(t){e["__taroref_spread-poster-export"]=t}(t),e["__taroref_spread-poster-export"]=t}})),n.k.createElement(u.a,{"className":"handler"},n.k.createElement(h.a,{"size":"mini","type":"primary","disabled":i,"loading":a,"onClick":this.downloadPoster},"下载推广海报"),n.k.createElement(h.a,{"size":"mini","type":"primary","loading":c,"onClick":this.downloadQrCode},"仅下载推广","二维","码"))),o&&n.k.createElement(u.a,{"className":"promotion-tip","onClick":this.showTip},n.k.createElement(m.a,{"className":"iconfont icon-tip"}),n.k.createElement(m.a,null,"如何赚钱")))),n.k.createElement(w.a,{"isShow":this.state.isShowTip,"onHide":this.hideTip},n.k.createElement(u.a,{"className":".header"},n.k.createElement(m.a,{"className":"iconfont icon-tip"}),n.k.createElement(m.a,null,"如何赚钱")),o&&n.k.createElement(y.a,{"nodes":o})));return n.k.createElement(b.a,{"onRefresh":this.onPullDownRefresh&&this.onPullDownRefresh.bind(this),"ref":function ref(t){t&&(e.pullDownRefreshRef=t)}},p)}},{"key":"componentDidMount","value":function componentDidMount(){k(QrcodeForPromotion.prototype.__proto__||Object.getPrototypeOf(QrcodeForPromotion.prototype),"componentDidMount",this)&&k(QrcodeForPromotion.prototype.__proto__||Object.getPrototypeOf(QrcodeForPromotion.prototype),"componentDidMount",this).call(this)}},{"key":"componentDidShow","value":function componentDidShow(){k(QrcodeForPromotion.prototype.__proto__||Object.getPrototypeOf(QrcodeForPromotion.prototype),"componentDidShow",this)&&k(QrcodeForPromotion.prototype.__proto__||Object.getPrototypeOf(QrcodeForPromotion.prototype),"componentDidShow",this).call(this),this.pullDownRefreshRef&&this.pullDownRefreshRef.bindEvent()}},{"key":"componentDidHide","value":function componentDidHide(){k(QrcodeForPromotion.prototype.__proto__||Object.getPrototypeOf(QrcodeForPromotion.prototype),"componentDidHide",this)&&k(QrcodeForPromotion.prototype.__proto__||Object.getPrototypeOf(QrcodeForPromotion.prototype),"componentDidHide",this).call(this),this.pullDownRefreshRef&&this.pullDownRefreshRef.unbindEvent()}}]),QrcodeForPromotion}()}}]);