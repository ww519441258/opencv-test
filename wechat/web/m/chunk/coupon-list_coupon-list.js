(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{"241":function(e,t,n){"use strict";n.d(t,"a",function(){return m});var o,r,a=n(1),i=n(2),c=n(51),s=n(10),l=n.n(s),u=n(240),p=n.n(u),f=(n(242),function(){function defineProperties(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e}}());var m=(r=o=function(e){function loading(e){!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,loading);var t=function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(loading.__proto__||Object.getPrototypeOf(loading)).call(this,e));return t.state={},t}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{"constructor":{"value":e,"enumerable":!1,"writable":!0,"configurable":!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(loading,i["a"].Component),f(loading,[{"key":"render","value":function render(){var e=this.props,t=e.type,n=e.display,o=e.tipText,r=l()("loading",t,n);return a.k.createElement(c.a,{"className":r},a.k.createElement(c.a,{"className":"circle"}),a.k.createElement(c.a,{"className":"text"},o,"..."))}}]),loading}(),o.options={"addGlobalClass":!0},o.propTypes={"type":p.a.oneOf(["center","block","inline"]),"display":p.a.oneOf(["dark","light"]),"tipText":p.a.string},o.defaultProps={"type":"center","display":"dark","tipText":"加载中"},r)},"242":function(e,t,n){},"244":function(e,t,n){"use strict";n.d(t,"a",function(){return f});var o,r,a=n(1),i=n(2),c=n(259),s=n(51),l=n(240),u=n.n(l),p=(n(256),function(){function defineProperties(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e}}());var f=(r=o=function(e){function Price(){return function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Price),function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(Price.__proto__||Object.getPrototypeOf(Price)).apply(this,arguments))}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{"constructor":{"value":e,"enumerable":!1,"writable":!0,"configurable":!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(Price,i["a"].Component),p(Price,[{"key":"render","value":function render(){var e=this.props,t=e.price,n=e.marketPrice,o=e.center,r=e.isExchange,i=t>0?Math.floor(t):Math.ceil(t),l=parseFloat(t).toFixed(2).toString().replace(/-?[0-9]*(\.?[0-9]*)/g,"$1"),u=parseFloat(n).toFixed(2),p=this.props.type,f=void 0;r&&(p="points");var m="price"===p;return f="price"===p?a.k.createElement(c.a,null,"￥"):"points"===p?a.k.createElement(c.a,{"className":"iconfont icon-point"}):a.k.createElement(c.a,{"className":"iconfont icon-exp"}),a.k.createElement(s.a,{"className":"price "+(o?"price-center":"")},a.k.createElement(c.a,{"className":"price__main price--"+p},f,a.k.createElement(c.a,{"className":"price__int"},i),m&&a.k.createElement(c.a,{"className":"price__dec"},l)),u>0&&a.k.createElement(c.a,{"className":"price__market-price"},"￥",u))}}]),Price}(),o.options={"addGlobalClass":!0},o.defaultProps={"price":0,"marketPrice":NaN,"isExchange":!1,"type":"price"},r);f.propTypes={"price":u.a.oneOfType([u.a.number,u.a.string]).isRequired,"marketPrice":u.a.oneOfType([u.a.number,u.a.string]),"isExchange":u.a.bool,"type":u.a.oneOf(["price","points","exp"])}},"253":function(e,t,n){"use strict";n.d(t,"a",function(){return m});var o,r,a=n(1),i=n(2),c=n(124),s=n(51),l=n(258),u=n(240),p=n.n(u),f=(n(254),function(){function defineProperties(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e}}());var m=(r=o=function(e){function Tip(e){!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Tip);var t=function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(Tip.__proto__||Object.getPrototypeOf(Tip)).call(this,e));return t.onClickButtonHandle=function(){var e=t.props,n=e.mainActionType,o=e.onClickMain;"back"===n?i.a.navigateBack():"home"===n?"WEAPP"===i.a.getEnv()?Object(c.d)({"url":"/pages/index/index"}):(i.a.redirectTo({"url":"/pages/index/index"}),window.location.reload()):"custom"===n&&o()},t.state={},t}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{"constructor":{"value":e,"enumerable":!1,"writable":!0,"configurable":!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(Tip,i["a"].Component),f(Tip,[{"key":"render","value":function render(){var e=this.props,t=e.type,n=e.icon,o=e.text,r=e.mainAction,i=e.height,c=e.mainActionType;return a.k.createElement(s.a,{"className":"tip "+t,"style":{"height":i}},a.k.createElement(s.a,{"className":"tip__content"},a.k.createElement(s.a,{"className":"iconfont icon-"+n}),a.k.createElement(s.a,{"className":"tip__text"},o),"none"!==c&&""!==r&&a.k.createElement(l.a,{"type":"primary","onClick":this.onClickButtonHandle},r)))}}]),Tip}(),o.options={"addGlobalClass":!0},o.defaultProps={"type":"auto","icon":"empty","text":"当前没有数据","height":"100%","mainAction":"返回上一级","mainActionType":"back"},r);m.propTypes={"type":p.a.oneOf(["full","auto"]),"icon":p.a.string,"text":p.a.string,"mainAction":p.a.string,"mainActionType":p.a.oneOf(["back","home","custom","none"]),"height":p.a.string,"onClickMain":p.a.func}},"254":function(e,t,n){},"256":function(e,t,n){},"271":function(e,t,n){"use strict";n.d(t,"a",function(){return m});var o,r,a=n(1),i=n(2),c=n(259),s=n(51),l=n(240),u=n.n(l),p=(n(281),n(244)),f=function(){function defineProperties(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e}}();var m=(r=o=function(e){function Cell(e){!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Cell);var t=function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(Cell.__proto__||Object.getPrototypeOf(Cell)).call(this,e));return t.onClick=function(){var e=t.props,n=e.disabled,o=e.onClick;n||o&&o()},t.state={},t}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{"constructor":{"value":e,"enumerable":!1,"writable":!0,"configurable":!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(Cell,i["a"].Component),f(Cell,[{"key":"render","value":function render(){var e=this.props,t=e.title,n=e.type,o=e.isExchange,r=e.isPrice,i=e.isLink,l=e.icon,u=e.disabled,f=e.value,m="cell "+(u?"disabled":i?"can-click ":""),d=void 0,h=void 0;return d="text"!==n?a.k.createElement(p.a,{"price":f,"type":n}):o?a.k.createElement(p.a,{"price":f,"isExchange":!0}):r?a.k.createElement(p.a,{"price":f}):a.k.createElement(c.a,null,f),!u&&i&&(h=a.k.createElement(c.a,{"className":"iconfont icon-right"})),a.k.createElement(s.a,{"className":m,"onClick":this.onClick},a.k.createElement(c.a,{"className":"left"},l&&a.k.createElement(c.a,{"className":"iconfont icon-"+l}),a.k.createElement(c.a,{"className":"text"},t)),a.k.createElement(s.a,null,d,this.props.children,h))}}]),Cell}(),o.options={"addGlobalClass":!0},o.defaultProps={"disabled":!1,"title":"","value":"","type":"text","isPrice":!1,"isExchange":!1,"isLink":!1},o.propTypes={"title":u.a.string.isRequired,"value":u.a.oneOfType([u.a.string,u.a.number]),"type":u.a.string,"isPrice":u.a.bool,"isExchange":u.a.bool,"isLink":u.a.bool,"disabled":u.a.bool,"onClick":u.a.func},r)},"281":function(e,t,n){},"295":function(e,t,n){"use strict";n.d(t,"a",function(){return k});var o,r,a=n(1),i=n(236),c=n(2),s=n(51),l=n(259),u=n(291),p=n(240),f=n.n(p),m=n(278),d=n.n(m),h=(n(296),n(77)),y=n(3),b=function(){function defineProperties(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e}}();var k=(r=o=function(e){function Coupon(e){!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Coupon);var t=function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(Coupon.__proto__||Object.getPrototypeOf(Coupon)).call(this,e));return t.handleClickCoupon=function(){var e=t.props,n=e.couponInfo,o=e.onClick;"take"===e.mode&&t.takeCoupon(n),o(n)},t.state={},t}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{"constructor":{"value":e,"enumerable":!1,"writable":!0,"configurable":!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(Coupon,c["a"].Component),b(Coupon,[{"key":"takeCoupon","value":function(){var e=function _asyncToGenerator(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){return function step(o,r){try{var a=t[o](r),i=a.value}catch(e){return void n(e)}if(!a.done)return Promise.resolve(i).then(function(e){step("next",e)},function(e){step("throw",e)});e(i)}("next")})}}(regeneratorRuntime.mark(function _callee(e){var t,n,o,r;return regeneratorRuntime.wrap(function _callee$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,Object(h.b)({"name":"takeCoupon","data":{"couponId":e.id}});case 2:if(t=a.sent,n=t.json,a.prev=4,!n){a.next=9;break}return o=n.cardId,r=n.cardExt,a.next=9,Object(i.a)({"cardList":[{"cardId":o,"cardExt":JSON.stringify(r)}]});case 9:Object(y.c)("领取成功"),c.a.eventCenter.trigger("update:userCenter"),a.next=16;break;case 13:a.prev=13,a.t0=a.catch(4),console.log("takeCouponFail: ",a.t0);case 16:case"end":return a.stop()}},_callee,this,[[4,13]])}));return function takeCoupon(t){return e.apply(this,arguments)}}()},{"key":"render","value":function render(){var e=this.props,t=e.couponInfo,n=e.mode,o=void 0,r=t.couponInfo||t,i=r.limit_id,c=r.type,p=r.description,f=r.favorable_content,m=r.least_cost,d=r.fixed_begin_term,h=void 0===d?0:d,y=r.fixed_term,b=void 0===y?0:y,k=t.begin_at||(t.couponInfo?t.couponInfo.begin_time:t.begin_time),_=t.end_at||(t.couponInfo?t.couponInfo.end_time:t.end_time);1===c?o=a.k.createElement(s.a,{"className":"coupon__left"},a.k.createElement(s.a,{"className":"number"},"￥",f),m&&a.k.createElement(s.a,{"className":"desc"},"满",m,"元可用")):2===c&&(o=a.k.createElement(s.a,{"className":"coupon__left"},a.k.createElement(s.a,{"className":"number"},a.k.createElement(l.a,null,(100-f)/10),a.k.createElement(l.a,null,"折")),m&&a.k.createElement(s.a,{"className":"desc"},"满",m,"元可用")));var v=i&&i.replace(/^.*【(.*)】.*$/,"$1"),C=v&&(v.length>15?i.replace(/【.*】/,"【"+v.substr(0,15)+"...】"):i);return a.k.createElement(s.a,{"className":"coupon"},a.k.createElement(s.a,{"className":"saw-tooth-bar"},Object.keys(Array.from({"length":6})).map(function(e){return a.k.createElement(s.a,{"key":e,"className":"tooth"})})),o,a.k.createElement(s.a,{"className":"coupon__right"},a.k.createElement(s.a,{"className":"gap-group"},a.k.createElement(s.a,{"className":"gap__left"}),a.k.createElement(s.a,{"className":"gap__right"})),a.k.createElement(s.a,{"className":"main"},a.k.createElement(s.a,{"className":"name"},C),a.k.createElement(s.a,{"className":"date"},k?a.k.createElement(l.a,null,formatTime(k)," 至 ",formatTime(_)):a.k.createElement(u.a,null,h>0&&a.k.createElement(l.a,{"style":{"marginRight":"5px"}},"领取",h,"天后有效"),b>0&&a.k.createElement(l.a,null,h<=0?"领取后":"","有效期",b,"天"))),a.k.createElement(s.a,{"className":"desc"},p)),"display"!==n&&a.k.createElement(s.a,{"className":"coupon__btn"},a.k.createElement(s.a,{"className":"btn","onClick":this.handleClickCoupon},"take"===n?"领取":"使用"))))}}]),Coupon}(),o.options={"addGlobalClass":!0},o.defaultProps={"couponInfo":{},"mode":"take","onClick":function onClick(){}},o.propTypes={"couponInfo":f.a.object.isRequired,"mode":f.a.oneOf(["take","use","display"]),"onClick":f.a.func},r);function formatTime(e){return e?Number.isNaN(1*e)?e.replace(/-/g,"."):d()(10===e.length?1e3*e:e).format("YYYY.MM.DD hh:mm:ss"):""}},"296":function(e,t,n){},"468":function(e,t,n){},"523":function(e,t,n){"use strict";n.r(t),n.d(t,"default",function(){return y});var o=n(1),r=n(239),a=n(2),i=n(11),c=n(51),s=n(260),l=(n(468),n(77)),u=n(241),p=n(253),f=n(295),m=n(271),d=function(){function defineProperties(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e}}(),h=function get(e,t,n){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,t);if(void 0===o){var r=Object.getPrototypeOf(e);return null===r?void 0:get(r,t,n)}if("value"in o)return o.value;var a=o.get;return void 0!==a?a.call(n):void 0};var y=function(e){function CouponList(e){var t=this;!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,CouponList);var n,o=function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(CouponList.__proto__||Object.getPrototypeOf(CouponList)).call(this,e));return o.config={"navigationBarTitleText":"优惠券"},o.useCoupon=(n=function _asyncToGenerator(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){return function step(o,r){try{var a=t[o](r),i=a.value}catch(e){return void n(e)}if(!a.done)return Promise.resolve(i).then(function(e){step("next",e)},function(e){step("throw",e)});e(i)}("next")})}}(regeneratorRuntime.mark(function _callee(e){var n;return regeneratorRuntime.wrap(function _callee$(t){for(;;)switch(t.prev=t.next){case 0:return n=o.$router.params.orderId,Object(r.b)(),t.prev=2,t.next=5,Object(l.b)({"name":"useCoupon","data":{"orderId":n,"couponId":e?e.id:-1}});case 5:Object(r.a)(),a.a.eventCenter.trigger("update:order"),a.a.navigateBack(),t.next=13;break;case 10:t.prev=10,t.t0=t.catch(2),Object(r.a)();case 13:case"end":return t.stop()}},_callee,t,[[2,10]])})),function(e){return n.apply(this,arguments)}),o.handleClickCoupon=function(e){var t=o.$router.params.mode;if("use"===(void 0===t?"take":t))return o.useCoupon(e)},o.handleClickUseNothing=function(){return o.useCoupon(null)},o.state={"couponList":null,"error":null},o}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{"constructor":{"value":e,"enumerable":!1,"writable":!0,"configurable":!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(CouponList,a["a"].Component),d(CouponList,[{"key":"componentWillMount","value":function componentWillMount(){var e=this,t=this.$router.params,n=t.mode,o=void 0===n?"take":n,r=t.orderId,a={};"use"===o&&((a={"orderId":r}).couponId=Object(i.c)("couponIdFromEntry")),Object(l.b)({"name":{"take":"getAllCoupon","own":"getMyCoupon","use":"getUsableCoupon"}[o],"data":a,"success":function success(t){"use"===o?e.setState({"couponList":t.list}):e.setState({"couponList":t})},"fail":function fail(t){t.data&&t.data.info&&e.setState({"error":t.data.info})},"hideToast":!0})}},{"key":"onShareAppMessage","value":function onShareAppMessage(){}},{"key":"onPullDownRefresh","value":function onPullDownRefresh(){this.componentWillMount()}},{"key":"render","value":function render(){var e=this,t=this.$router.params.mode,n=void 0===t?"take":t,r=this.state,a=r.couponList,i=r.error,l=void 0;if(a&&a.length>0){var d=a.map(function(t){return o.k.createElement(f.a,{"key":t.id,"couponInfo":t,"mode":n,"onClick":e.handleClickCoupon})});l=o.k.createElement(c.a,null,"use"===n&&o.k.createElement(m.a,{"title":"不使用优惠券","onClick":this.handleClickUseNothing,"isLink":!0}),d)}else l=a?o.k.createElement(p.a,{"type":"full","text":"目前没有可"+("use"===n?"使用":"领取")+"的优惠券"}):i?o.k.createElement(p.a,{"type":"full","icon":"unhappy","text":i}):o.k.createElement(u.a,null);var h=o.k.createElement(c.a,{"className":"coupon-list"},l);return o.k.createElement(s.a,{"onRefresh":this.onPullDownRefresh&&this.onPullDownRefresh.bind(this),"ref":function ref(t){t&&(e.pullDownRefreshRef=t)}},h)}},{"key":"componentDidMount","value":function componentDidMount(){h(CouponList.prototype.__proto__||Object.getPrototypeOf(CouponList.prototype),"componentDidMount",this)&&h(CouponList.prototype.__proto__||Object.getPrototypeOf(CouponList.prototype),"componentDidMount",this).call(this)}},{"key":"componentDidShow","value":function componentDidShow(){h(CouponList.prototype.__proto__||Object.getPrototypeOf(CouponList.prototype),"componentDidShow",this)&&h(CouponList.prototype.__proto__||Object.getPrototypeOf(CouponList.prototype),"componentDidShow",this).call(this),this.pullDownRefreshRef&&this.pullDownRefreshRef.bindEvent()}},{"key":"componentDidHide","value":function componentDidHide(){h(CouponList.prototype.__proto__||Object.getPrototypeOf(CouponList.prototype),"componentDidHide",this)&&h(CouponList.prototype.__proto__||Object.getPrototypeOf(CouponList.prototype),"componentDidHide",this).call(this),this.pullDownRefreshRef&&this.pullDownRefreshRef.unbindEvent()}}]),CouponList}()}}]);