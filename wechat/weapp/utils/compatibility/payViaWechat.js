"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.payViaWechatInWeb=exports.payViaWechatInWeapp=void 0;var _extends=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var n=arguments[r];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])}return e},_index=require("../../npm/@tarojs/taro-weapp/index.js"),_index2=_interopRequireDefault(_index),_helper=require("../helper.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var getWechatPayParams=function(e){var r=e.env,n=e.orderId,t=e.success,a=e.skip,i=e.fail;_index2.default.ajax({name:"getPayParamsFor"+(r.charAt(0).toUpperCase()+r.substr(1)),data:{id:n},success:function(e){if(1===e.status)a();else{var r="string"==typeof e?JSON.parse(e):e;t(r)}},fail:function(e){i(e)}})},payViaWechatInWeapp=exports.payViaWechatInWeapp=function(e,r,n){getWechatPayParams({env:"weapp",orderId:e,success:function(e){1===e.status?r():_index2.default.requestPayment(_extends({},e,{success:function(){r()},fail:function(e){n(e),"requestPayment:fail cancel"===e.errMsg?(0,_helper.showInfo)("支付取消"):(0,_helper.showError)(e.errMsg)}}))},skip:function(){r()},fail:function(e){n(e)}})},payViaWechatInWeb=exports.payViaWechatInWeb=function(e,n,r){getWechatPayParams({env:"web",orderId:e,success:function(e){if(1===e)n();else{var r=function(){WeixinJSBridge?WeixinJSBridge.invoke("getBrandWCPayRequest",e,function(e){1===e.err_code||"get_brand_wcpay_request:ok"===e.err_msg?n():"get_brand_wcpay_request:cancel"===e.err_msg?(0,_helper.showInfo)("支付取消"):e.err_desc?(0,_helper.showError)(e.err_desc):e.err_msg?(0,_helper.showError)(e.err_msg):(0,_helper.showError)(JSON.stringify(e))}):(0,_helper.showError)("请在微信中打开（WeixinJSBridge is undefined）")};"undefined"==typeof WeixinJSBridge?document.addEventListener?document.addEventListener("WeixinJSBridgeReady",r,!1):document.attachEvent&&(document.attachEvent("WeixinJSBridgeReady",r),document.attachEvent("onWeixinJSBridgeReady",r)):r()}},skip:function(){n()},fail:function(e){r(e)}})};