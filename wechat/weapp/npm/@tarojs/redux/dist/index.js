"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var Taro=require("../../taro/index.js"),Taro__default=_interopDefault(Taro),store=null,appGlobal=global||{},globalRef=Object.getPrototypeOf(appGlobal)||appGlobal;function getStore(){return store}function setStore(e){store=e}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _possibleConstructorReturn(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?_assertThisInitialized(e):t}function _superPropBase(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_getPrototypeOf(e)););return e}function _get(e,t,r){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=_superPropBase(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_nonIterableRest()}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _iterableToArrayLimit(e,t){var r=[],n=!0,o=!1,i=void 0;try{for(var s,u=e[Symbol.iterator]();!(n=(s=u.next()).done)&&(r.push(s.value),!t||r.length!==t);n=!0);}catch(e){o=!0,i=e}finally{try{n||null==u.return||u.return()}finally{if(o)throw i}}return r}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function isObject(e){return null!=e&&"object"===_typeof(e)&&!Array.isArray(e)}function mergeObjects(e,t){var r=Object.assign({},e);if(isObject(e)&&isObject(t))for(var n in t)isObject(e[n])&&isObject(t[n])?r[n]=mergeObjects(e[n],t[n]):r[n]=t[n];return r}function wrapPropsWithDispatch(n,o){return"function"==typeof n?n(o):isObject(n)?Object.keys(n).reduce(function(e,t){var r=n[t];return"function"==typeof r&&(e[t]=function(){return o(r.apply(void 0,arguments))}),e},{}):{}}function connect(i,e){var s=getStore(),t=s.dispatch,u=wrapPropsWithDispatch(e,t);u.dispatch=t;return function(t){var e=i(s.getState(),t.defaultProps||{});t.properties&&e&&Object.keys(e).forEach(function(e){delete t.properties[e]});var r=null;return function(e){function n(e,t){var r;return _classCallCheck(this,n),r=_possibleConstructorReturn(this,_getPrototypeOf(n).call(this,Object.assign.apply(Object,Array.prototype.slice.call(arguments).concat([mergeObjects(i(s.getState(),e),u)])),t)),Object.keys(u).forEach(function(e){r["__event_".concat(e)]=u[e]}),r}return _inherits(n,t),_createClass(n,[{key:"componentWillMount",value:function(){var e=getStore();Object.assign(this.props,mergeObjects(i(e.getState(),this.props),u)),r=e.subscribe(function(){var r=this,n=!1,o=i(s.getState(),this.props),e=Object.assign({},this.props);Object.keys(o).forEach(function(e){var t=o[e];isObject(t)&&isObject(u[e])&&(t=mergeObjects(t,u[e])),r.props[e]!==t&&(r.props[e]=t,n=!0)}),n&&(this.prevProps=e,this._unsafeCallUpdate=!0,this.setState({},function(){delete r._unsafeCallUpdate}))}.bind(this)),_get(_getPrototypeOf(n.prototype),"componentWillMount",this)&&_get(_getPrototypeOf(n.prototype),"componentWillMount",this).call(this)}},{key:"componentWillUnmount",value:function(){_get(_getPrototypeOf(n.prototype),"componentWillUnmount",this)&&_get(_getPrototypeOf(n.prototype),"componentWillUnmount",this).call(this),r&&r(),r=null}}]),n}()}}var Provider=function e(){_classCallCheck(this,e)},ReduxContext=Taro__default.createContext(null);function useReduxContext(){return Taro.useContext(ReduxContext)}function useStore(){return useReduxContext().store}function useDispatch(){return useStore().dispatch}function defaultNoopBatch(e){e()}var batch=defaultNoopBatch,getBatch=function(){return batch},CLEARED=null,nullListeners={notify:function(){}};function createListenerCollection(){var e=getBatch(),r=[],n=[];return{clear:function(){r=n=CLEARED},notify:function(){var t=r=n;e(function(){for(var e=0;e<t.length;e++)t[e]()})},get:function(){return n},subscribe:function(e){var t=!0;return n===r&&(n=r.slice()),n.push(e),function(){t&&r!==CLEARED&&(t=!1,n===r&&(n=r.slice()),n.splice(n.indexOf(e),1))}}}}var Subscription=function(){function r(e,t){_classCallCheck(this,r),this.store=e,this.parentSub=t,this.unsubscribe=null,this.listeners=nullListeners,this.handleChangeWrapper=this.handleChangeWrapper.bind(this)}return _createClass(r,[{key:"addNestedSub",value:function(e){return this.trySubscribe(),this.listeners.subscribe(e)}},{key:"notifyNestedSubs",value:function(){this.listeners.notify()}},{key:"handleChangeWrapper",value:function(){this.onStateChange&&this.onStateChange()}},{key:"isSubscribed",value:function(){return Boolean(this.unsubscribe)}},{key:"trySubscribe",value:function(){this.unsubscribe||(this.unsubscribe=this.parentSub?this.parentSub.addNestedSub(this.handleChangeWrapper):this.store.subscribe(this.handleChangeWrapper),this.listeners=createListenerCollection())}},{key:"tryUnsubscribe",value:function(){this.unsubscribe&&(this.unsubscribe(),this.unsubscribe=null,this.listeners.clear(),this.listeners=nullListeners)}}]),r}();function invariant(e,t,r,n,o,i,s,u){if(!e){var c;if(void 0===t)c=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var a=[r,n,o,i,s,u],l=0;(c=new Error(t.replace(/%s/g,function(){return a[l++]}))).name="Invariant Violation"}throw c.framesToPop=1,c}}var refEquality=function(e,t){return e===t};function useSelector(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:refEquality;invariant(e,"You must pass a selector to useSelectors");var r,n=useReduxContext(),o=n.store,i=n.subscription,s=_slicedToArray(Taro.useReducer(function(e){return e+1},0),2)[1],u=Taro.useMemo(function(){return new Subscription(o,i)},[o,i]),c=Taro.useRef(),a=Taro.useRef(),l=Taro.useRef();try{r=e!==a.current||c.current?e(o.getState()):l.current}catch(e){var f="An error occured while selecting the store state: ".concat(e.message,".");throw c.current&&(f+="\nThe error may be correlated with this previous error:\n".concat(c.current.stack,"\n\nOriginal stack trace:")),new Error(f)}return Taro.useEffect(function(){a.current=e,l.current=r,c.current=void 0}),Taro.useEffect(function(){function e(){try{var e=a.current(o.getState());if(t(e,l.current))return;l.current=e}catch(e){c.current=e}s({})}return u.onStateChange=e,u.trySubscribe(),e(),function(){return u.tryUnsubscribe()}},[o,u]),r}var index={connect:connect,Provider:Provider,getStore:getStore,setStore:setStore,useDispatch:useDispatch,useSelector:useSelector,useStore:useStore,ReduxContext:ReduxContext};exports.default=index,exports.connect=connect,exports.Provider=Provider,exports.getStore=getStore,exports.setStore=setStore,exports.useDispatch=useDispatch,exports.useSelector=useSelector,exports.useStore=useStore,exports.ReduxContext=ReduxContext;