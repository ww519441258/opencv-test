"use strict";var _interopRequireWildcard=require("../../@babel/runtime/helpers/interopRequireWildcard.js"),_interopRequireDefault=require("../../@babel/runtime/helpers/interopRequireDefault.js");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=getSaga;var _getIterator2=_interopRequireDefault(require("../../@babel/runtime/core-js/get-iterator.js")),_objectSpread2=_interopRequireDefault(require("../../@babel/runtime/helpers/objectSpread.js")),_toConsumableArray2=_interopRequireDefault(require("../../@babel/runtime/helpers/toConsumableArray.js")),_regenerator=_interopRequireDefault(require("../../@babel/runtime/regenerator/index.js")),_invariant=_interopRequireDefault(require("../../invariant/invariant.js")),sagaEffects=_interopRequireWildcard(require("../../redux-saga/lib/effects.js")),_warning=_interopRequireDefault(require("../npm/warning/warning.js")),_sagaHelpers=require("../../redux-saga/lib/internal/sagaHelpers/index.js"),_constants=require("./constants.js"),_prefixType=_interopRequireDefault(require("./prefixType.js"));function getSaga(n,s,u,c){return _regenerator.default.mark(function e(){var a;return _regenerator.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=_regenerator.default.keys(n);case 1:if((e.t1=e.t0()).done){e.next=7;break}if(a=e.t1.value,Object.prototype.hasOwnProperty.call(n,a))return e.delegateYield(_regenerator.default.mark(function e(){var t,r;return _regenerator.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=getWatcher(a,n[a],s,u,c),e.next=3,sagaEffects.fork(t);case 3:return r=e.sent,e.next=6,sagaEffects.fork(_regenerator.default.mark(function e(){return _regenerator.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,sagaEffects.take("".concat(s.namespace,"/@@CANCEL_EFFECTS"));case 2:return e.next=4,sagaEffects.cancel(r);case 4:case"end":return e.stop()}},e,this)}));case 6:case"end":return e.stop()}},e,this)})(),"t2",5);e.next=5;break;case 5:e.next=1;break;case 7:case"end":return e.stop()}},e,this)})}function getWatcher(p,e,l,d,t){var r,_=_regenerator.default.mark(s),g=e,a="takeEvery";if(Array.isArray(e)){g=e[0];var n=e[1];n&&n.type&&"throttle"===(a=n.type)&&((0,_invariant.default)(n.ms,"app.start: opts.ms should be defined if type is throttle"),r=n.ms),(0,_invariant.default)(-1<["watcher","takeEvery","takeLatest","throttle"].indexOf(a),"app.start: effect type should be takeEvery, takeLatest, throttle or watcher")}function v(){}function s(){var t,r,a,n,s,u,c,f,i,o=arguments;return _regenerator.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(t=o.length,r=new Array(t),a=0;a<t;a++)r[a]=o[a];return n=0<r.length?r[0]:{},s=n.__dva_resolve,u=void 0===s?v:s,c=n.__dva_reject,f=void 0===c?v:c,e.prev=2,e.next=5,sagaEffects.put({type:"".concat(p).concat(_constants.NAMESPACE_SEP,"@@start")});case 5:return e.next=7,g.apply(void 0,(0,_toConsumableArray2.default)(r.concat(createEffects(l))));case 7:return i=e.sent,e.next=10,sagaEffects.put({type:"".concat(p).concat(_constants.NAMESPACE_SEP,"@@end")});case 10:u(i),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(2),d(e.t0,{key:p,effectArgs:r}),e.t0._dontReject||f(e.t0);case 17:case"end":return e.stop()}},_,this,[[2,13]])}var u=applyOnEffect(t,s,l,p);switch(a){case"watcher":return s;case"takeLatest":return _regenerator.default.mark(function e(){return _regenerator.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,_sagaHelpers.takeLatestHelper)(p,u);case 2:case"end":return e.stop()}},e,this)});case"throttle":return _regenerator.default.mark(function e(){return _regenerator.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,_sagaHelpers.throttleHelper)(r,p,u);case 2:case"end":return e.stop()}},e,this)});default:return _regenerator.default.mark(function e(){return _regenerator.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,_sagaHelpers.takeEveryHelper)(p,u);case 2:case"end":return e.stop()}},e,this)})}}function createEffects(r){function a(e,t){(0,_invariant.default)(e,"dispatch: action should be a plain Object with type"),(0,_warning.default)(0!==e.indexOf("".concat(r.namespace).concat(_constants.NAMESPACE_SEP)),"[".concat(t,"] ").concat(e," should not be prefixed with namespace ").concat(r.namespace))}function e(e){var t=e.type;return a(t,"sagaEffects.put"),sagaEffects.put((0,_objectSpread2.default)({},e,{type:(0,_prefixType.default)(t,r)}))}return e.resolve=function(e){var t=e.type;return a(t,"sagaEffects.put.resolve"),sagaEffects.put.resolve((0,_objectSpread2.default)({},e,{type:(0,_prefixType.default)(t,r)}))},(0,_objectSpread2.default)({},sagaEffects,{put:e,take:function(e){return"string"==typeof e?(a(e,"sagaEffects.take"),sagaEffects.take((0,_prefixType.default)(e,r))):Array.isArray(e)?sagaEffects.take(e.map(function(e){return"string"==typeof e?(a(e,"sagaEffects.take"),(0,_prefixType.default)(e,r)):e})):sagaEffects.take(e)}})}function applyOnEffect(e,t,r,a){var n=!0,s=!1,u=void 0;try{for(var c,f=(0,_getIterator2.default)(e);!(n=(c=f.next()).done);n=!0){t=(0,c.value)(t,sagaEffects,r,a)}}catch(e){s=!0,u=e}finally{try{n||null==f.return||f.return()}finally{if(s)throw u}}return t}