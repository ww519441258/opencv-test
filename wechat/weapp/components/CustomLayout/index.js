"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _class,_temp2,_createClass=function(){function a(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}}(),_get=function e(t,n,a){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var r=Object.getPrototypeOf(t);return null===r?void 0:e(r,n,a)}if("value"in o)return o.value;var i=o.get;return void 0!==i?i.call(a):void 0},_index=require("../../npm/@tarojs/taro-weapp/index.js"),_index2=_interopRequireDefault(_index),_index3=require("../../npm/prop-types/index.js"),_index4=_interopRequireDefault(_index3),_ajax=require("../../utils/ajax.js"),_ajax2=_interopRequireDefault(_ajax);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var CustomLayout=(_temp2=_class=function(e){function r(){var e,t,i;_classCallCheck(this,r);for(var n=arguments.length,a=Array(n),o=0;o<n;o++)a[o]=arguments[o];return(t=i=_possibleConstructorReturn(this,(e=r.__proto__||Object.getPrototypeOf(r)).call.apply(e,[this].concat(a)))).$usedState=["loopArray29","$compid__128","errMsg","pageLayout","homeData","pageData","event","__fn_on","isHomePage","pageId"],i.getData=function(){var t=i.props.isHomePage;t||i.getPageLayout(),(0,_ajax2.default)({name:"getHomeData",success:function(e){i.featureConfig=e.config,t&&e.config.layoutEnabled?i.getPageLayout():t&&i.transformLayout(e),i.setState({homeData:e}),_index2.default.setStorageSync("config",e.config)}})},i.featureConfig=null,i.getPageLayout=function(){var e=i.props,t=e.pageId,n=e.isHomePage;(0,_ajax2.default)({name:"getPageLayout",data:n?{}:{id:t},success:function(e){var t=e.content,n=e.pageData;t&&0<t.length?i.setState({pageLayout:t,pageData:n,errMsg:""}):i.setState({errMsg:"页面布局为空，请在【后台管理页面】的【系统管理】下的【页面布局管理】进行布局编辑"})},fail:function(e){var t=e.data,n=e.info,a=e.statusCode;n?i.setState({errMsg:n+"，请在【后台管理页面】的【系统管理】下的【页面布局管理】进行布局编辑"}):t&&t.message?i.setState({errMsg:"服务器错误("+a+"): "+t.message}):i.setState({errMsg:"请求出错"})},hideToast:!0})},i.transformLayout=function(n){var a=["","scroll","grid3","list"],o=4,e=n.type.map(function(e){var t=e.name.replace(/^is_([A-Za-z]+)$/,"$1");return{id:o++,component:"GoodsList",type:a[e.type],title:e.title,banners:n[t].banner,dataOrigin:{type:"goodsStatus",value:t}}}),t=[{id:1,component:"SearchBar"},{id:2,component:"Swiper",data:n.banner.map(function(e){return{url:e,ratio:.6}})},{id:3,component:"NavGrid"}].concat(_toConsumableArray(e)),r={goodsStatus:{new:n.new.goods,best:n.best.goods,hot:n.hot.goods}};i.setState({pageLayout:t,pageData:r,errMsg:""})},i.goto=function(e){e&&_index2.default.navigateTo({url:"/pages/"+e+"/"+e})},i.customComponents=["Tip","Search","SwiperX","NavGrid","Part","Banner","RichTextPro","Blank","Divider","Loading"],_possibleConstructorReturn(i,t)}return _inherits(r,_index.Component),_createClass(r,[{key:"_constructor",value:function(e){_get(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"_constructor",this).call(this,e),this.state={homeData:null,pageLayout:null,pageData:null,errMsg:""},this.$$refs=[]}},{key:"componentWillMount",value:function(){var e=this,t=this.props.event;this.getData(),_index2.default.eventCenter.on("reload:"+t,function(){e.setState({homeData:null}),e.getData()})}},{key:"_createData",value:function(){this.__state=arguments[0]||this.state||{},this.__props=arguments[1]||this.props||{};arguments[2];var l=this.$prefix,e=(0,_index.genCompid)(l+"$compid__128"),t=void 0,n=this.__state,a=n.homeData,o=n.pageLayout,c=n.pageData,r=n.errMsg;return r?_index.propsManager.set({type:"full",text:r,mainActionType:"none"},e):o&&a&&(t=o.map(function(e,t){e={$original:(0,_index.internal_get_original)(e)};var n=(0,_index.genCompid)(l+"RnCDvfKTgE"+t);"SearchBar"===e.$original.component&&_index.propsManager.set({layoutInfo:e.$original},n);var a=(0,_index.genCompid)(l+"iepvYldIMQ"+t);"Swiper"===e.$original.component&&_index.propsManager.set({layoutInfo:e.$original},a);var o=(0,_index.genCompid)(l+"HCLEpgsgKz"+t);"NavGrid"===e.$original.component&&_index.propsManager.set({layoutInfo:e.$original},o);var r=(0,_index.genCompid)(l+"zDdEnsKGqz"+t);"GoodsList"===e.$original.component&&_index.propsManager.set({layoutInfo:e.$original,layoutData:c},r);var i=(0,_index.genCompid)(l+"cYBdrvaTuI"+t);"Banner"===e.$original.component&&_index.propsManager.set({layoutInfo:e.$original},i);var s=(0,_index.genCompid)(l+"IYZLBpWkMr"+t);"RichText"===e.$original.component&&_index.propsManager.set({nodes:e.$original.content,backgroundColor:e.$original.backgroundColor,horizontalPadding:e.$original.horizontalPadding,verticalPadding:e.$original.verticalPadding},s);var p=(0,_index.genCompid)(l+"wVXlIngdCT"+t);"Blank"===e.$original.component&&_index.propsManager.set({height:e.$original.height},p);var u=(0,_index.genCompid)(l+"CVNuqQivoz"+t);return"Divider"===e.$original.component&&_index.propsManager.set({layoutInfo:e.$original},u),{$compid__120:n,$compid__121:a,$compid__122:o,$compid__123:r,$compid__124:i,$compid__125:s,$compid__126:p,$compid__127:u,$original:e.$original}})),Object.assign(this.__state,{loopArray29:t,$compid__128:e}),this.__state}}]),r}(),_class.$$events=[],_class.propTypes={pageId:_index4.default.oneOfType([_index4.default.number,_index4.default.string]).isRequired,isHomePage:_index4.default.bool,event:_index4.default.string},_class.defaultProps={pageId:1,isHomePage:!1,event:""},_class.$$componentPath="components/CustomLayout/index",_temp2);exports.default=CustomLayout,Component(require("../../npm/@tarojs/taro-weapp/index.js").default.createComponent(CustomLayout));