"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _class,_temp2,_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},_createClass=function(){function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}}(),_get=function e(t,n,o){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,n,o)}if("value"in i)return i.value;var r=i.get;return void 0!==r?r.call(o):void 0},_index=require("../../npm/@tarojs/taro-weapp/index.js"),_index2=_interopRequireDefault(_index),_index3=require("../../npm/classnames/index.js"),_index4=_interopRequireDefault(_index3),_index5=require("../../npm/prop-types/index.js"),_index6=_interopRequireDefault(_index5),_ajax=require("../../utils/ajax.js"),_ajax2=_interopRequireDefault(_ajax);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var List=(_temp2=_class=function(e){function r(){var e,t,o;_classCallCheck(this,r);for(var n=arguments.length,i=Array(n),a=0;a<n;a++)i[a]=arguments[a];return(t=o=_possibleConstructorReturn(this,(e=r.__proto__||Object.getPrototypeOf(r)).call.apply(e,[this].concat(i)))).$usedState=["$compid__129","$compid__130","$compid__131","listData","className","isEmpty","showLoading","event","__fn_on","numberPerPage","emptyTip","buttonText","mode","children"],o.getData=function(){if(!o.loading&&!o.isFinished&&!o.showLoading){var e=o.apiName,t=o.params;o.loading=!0,(0,_ajax2.default)({name:e,data:_extends({page:o.page++},t),success:function(e){var t=Array.isArray(e)?e:e.data||e.order,n=o.listData;n||(n=[]),n=n.concat(t),o.listData=n,o.props.onLoadData(n,e),0===n.length&&0===t.length&&o.setState({isEmpty:!0}),t.length<o.props.numberPerPage&&(o.isFinished=!0,o.setState({showLoading:!1})),o.loading=!1}})}},o.refreshData=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:o.apiName,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:o.params;o.isFinished=!1,o.loading=!1,o.page=0,o.listData=[],o.apiName=e,o.params=t,o.setState({showLoading:!0,isEmpty:!1}),o.getData()},o.onClickButtonHandle=function(){o.props.onClickButton?o.props.onClickButton():_index2.default.navigateBack()},o.onScroll=function(e){var t=e.detail,n=t.scrollTop;t.scrollHeight-n<800&&o.getData()},o.customComponents=["Loading","Tip"],_possibleConstructorReturn(o,t)}return _inherits(r,_index.Component),_createClass(r,[{key:"_constructor",value:function(e){_get(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"_constructor",this).call(this,e),this.page=0,this.isFinished=!1,this.loading=!1,this.listData=[],this.apiName="",this.params={},this.state={isEmpty:!1,showLoading:!0},this.$$refs=[]}},{key:"componentWillMount",value:function(){var n=this,e=this.props,t=e.event;e.onMount;_index2.default.eventCenter.on("load:"+t,function(){n.getData()}),_index2.default.eventCenter.on("reload:"+t,function(e,t){n.refreshData(e,t)}),this.props.onMount()}},{key:"componentWillUnmount",value:function(){var e=this.props.event;_index2.default.eventCenter.off("load:"+e),_index2.default.eventCenter.off("reload:"+e)}},{key:"_createData",value:function(){this.__state=arguments[0]||this.state||{},this.__props=arguments[1]||this.props||{};arguments[2];var e=this.$prefix,t=(0,_index.genCompid)(e+"$compid__129"),n=(0,_index.genCompid)(e+"$compid__130"),o=(0,_index.genCompid)(e+"$compid__131"),i=this.listData;this.willReload&&(this.willReload=!1),0<i.length?i&&this.__state.showLoading&&_index.propsManager.set({type:"inline"},t):this.__state.isEmpty?_index.propsManager.set({icon:"empty",text:this.__props.emptyTip,mainActionType:"back",mainAction:this.__props.buttonText,onClickMain:this.onClickButtonHandle,type:"full"===this.__props.mode?"full":"auto"},n):_index.propsManager.set({type:"block"===this.__props.mode?"block":void 0},o);var a=(0,_index4.default)("list",{block:"block"===this.__props.mode,empty:this.__state.isEmpty,full:"full"===this.__props.mode});return Object.assign(this.__state,{$compid__129:t,$compid__130:n,$compid__131:o,listData:i,className:a}),this.__state}}]),r}(),_class.$$events=["onScroll"],_class.options={addGlobalClass:!0},_class.defaultProps={event:"page",apiName:"",numberPerPage:10,data:{},emptyTip:"没有内容",buttonText:"返回上一级",mode:"full",onLoadData:function(){},onMount:function(){}},_class.propTypes={event:_index6.default.string,numberPerPage:_index6.default.number,emptyTip:_index6.default.string,buttonText:_index6.default.string,mode:_index6.default.string,onLoadData:_index6.default.func,onMount:_index6.default.func},_class.$$componentPath="components/List/index",_temp2);exports.default=List,Component(require("../../npm/@tarojs/taro-weapp/index.js").default.createComponent(List));