"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _class,_temp2,_createClass=function(){function n(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,a){return t&&n(e.prototype,t),a&&n(e,a),e}}(),_get=function e(t,a,n){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,a);if(void 0===r){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,a,n)}if("value"in r)return r.value;var i=r.get;return void 0!==i?i.call(n):void 0},_index=require("../../npm/@tarojs/taro-weapp/index.js"),_index2=_interopRequireDefault(_index),_ajax=require("../../utils/ajax.js"),_ajax2=_interopRequireDefault(_ajax),_globalData=require("../../utils/global-data.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var EditAddress=(_temp2=_class=function(e){function o(){var e,t,f;_classCallCheck(this,o);for(var a=arguments.length,n=Array(a),r=0;r<a;r++)n[r]=arguments[r];return(t=f=_possibleConstructorReturn(this,(e=o.__proto__||Object.getPrototypeOf(o)).call.apply(e,[this].concat(n)))).$usedState=["anonymousState__temp","$compid__55","areaText","areaPickerData","checkedArea","addressInfo","isChoose","isEdit","code"],f.config={navigationBarTitleText:"修改收货地址",enablePullDownRefresh:!1},f.handleAreaChange=function(e){var t=f.state.areaPickerData,a=e.detail.value,n=[t[0][a[0]]||{name:"省",code:-1},t[1][a[1]]||{name:"市",code:-1},t[2][a[2]]||{name:"县/区",code:-1}];f.setState({checkedArea:a,areaText:[n[0].name,n[1].name,n[2].name],code:[n[0].code,n[1].code,n[2].code]})},f.handleSave=function(e){var t=f.state.code,a=e.detail.value,n=a.consignee,r=a.tel,o=a.detail;f.saveAddress({code:t,consignee:n,tel:r,detail:o})},f.onSetDefault=function(){(0,_ajax2.default)({name:"setDefaultAddress",data:{id:f.addressInfo.id},success:function(){_index2.default.eventCenter.trigger("update:address"),_index2.default.navigateBack()},hintText:"设置"})},f.saveAddress=function(e){var t=e.code,a=e.consignee,n=e.tel,r=e.detail,o=(0,_globalData.getGlobalData)("address");function i(e){_index2.default.showToast({title:e,icon:"none"})}if(""===a)return i("请填写收件人");if(a.length<2||6<a.length)return i("收件人长度必须大于2个字符小于6个字符");if(""===n)return i("请填写手机号码");if(11!==n.length)return i("手机号码必须为11位");if(!t||-1===t[0])return i("请选择所在地区");if(-1===t[1])return i("请选择所在城市");if(-1===t[2])return i("请选择所在县/区");if(""===r)return i("请填写详细地址");if(r.length<4||25<r.length)return i("详细地址长度必须大于4个字符小于25个字符");var s={consignee:a,tel:n,province:t[0],city:t[1],district:t[2],area_code:t[2],address:r},d="";o?(d="editAddress",s.id=o.id):d="addAddress",(0,_ajax2.default)({name:d,data:s,success:function(e){f.$router.params.choose?(0,_ajax2.default)({name:"chooseAddress",data:{id:o?o.id:e.id,orderId:f.$router.params.choose},success:function(){_index2.default.eventCenter.trigger("update:order"),_index2.default.navigateBack()}}):(_index2.default.eventCenter.trigger("update:address"),_index2.default.navigateBack())}})},f.onDelete=function(){var t=(0,_globalData.getGlobalData)("address");_index2.default.showModal({title:"提示",content:"确定要删除此地址吗？",success:function(e){e.confirm&&(0,_ajax2.default)({name:"delAddress",data:{id:t.id},success:function(){_index2.default.eventCenter.trigger("update:address"),_index2.default.navigateBack()}})}})},f.onUpdateForm=function(e,t){var a=f.state.addressInfo;"string"==typeof t.detail.value?a[e]=t.detail.value:"string"==typeof t.data&&(a[e]?a[e]+=t.data:a[e]=t.data),f.setState({addressInfo:a})},f.handleAreaColumnChange=function(e){f.updatePickerData(e.detail.column,e.detail.value)},f.handleClickImport=function(){_index2.default.chooseAddress({success:function(e){if("chooseAddress:ok"===e.errMsg){_index2.default.showLoading({title:"导入中"});var t,a=e.userName,n=e.telNumber,r=e.detailInfo,o=e.provinceName,i=e.cityName,s=e.countyName,d=void 0,l=void 0,c=f.areaData,u="";0<=(t=c[0].findIndex(function(e){return e.name===o}))?(0<=(d=(c=f.updatePickerData(0,t,!1,!0))[1].findIndex(function(e){return e.name===i}))?-1===(l=(c=f.updatePickerData(1,d,!1,!0))[2].findIndex(function(e){return e.name===s}))&&(u="未能在数据库中找到该县/区，请手动选择"):u="未能在数据库中找到该城市，请手动选择",f.handleAreaChange({detail:{value:[t,d,l]}})):u="未能在数据库中找到该地区，请手动选择",_index2.default.hideLoading(),u&&_index2.default.showModal({content:u,showCancel:!1}),f.setState({checkedArea:[t,d,l],addressInfo:(0,_globalData.getGlobalData)("address")||{consignee:a,tel:n,address:r}})}}})},f.customComponents=["Loading"],_possibleConstructorReturn(f,t)}return _inherits(o,_index.Component),_createClass(o,[{key:"_constructor",value:function(e){var t=(0,_globalData.getGlobalData)("address"),a=[],n=[];t&&6===t.area_code.length&&(n=[t.area_code.substr(0,2)+"0000",t.area_code.substr(0,4)+"00",t.area_code],a=[t.province,t.city,t.district]),_get(o.prototype.__proto__||Object.getPrototypeOf(o.prototype),"_constructor",this).call(this,e),this.areaData=[],this.addressInfo=t,this.state={areaText:a,code:n,areaPickerData:null,checkedArea:[],addressInfo:(0,_globalData.getGlobalData)("address")||{consignee:"",tel:"",address:""}},this.$$refs=[]}},{key:"componentWillMount",value:function(){var l=this;(0,_globalData.getGlobalData)("address")||_index2.default.setNavigationBarTitle({title:"新建收货地址"}),_index2.default.showLoading({title:"加载地区数据中"}),(0,_ajax2.default)({name:"getAreaData",success:function(e){var t=!0,a=!(l.areaData=[]),n=void 0;try{for(var r,o=["province_list","city_list","county_list"][Symbol.iterator]();!(t=(r=o.next()).done);t=!0){var i=r.value,s=[];for(var d in e[i])s.push({code:d,name:e[i][d]});l.areaData.push(s)}}catch(e){a=!0,n=e}finally{try{!t&&o.return&&o.return()}finally{if(a)throw n}}l.updatePickerData(0,0,!0),_index2.default.hideLoading()}})}},{key:"onShareAppMessage",value:function(){}},{key:"updatePickerData",value:function(e,t){var a=2<arguments.length&&void 0!==arguments[2]&&arguments[2],n=3<arguments.length&&void 0!==arguments[3]&&arguments[3],r=this.areaData,o=this.state.areaPickerData;if(a){var i=(0,_globalData.getGlobalData)("address"),s=[],d=[0,0,0];i&&6===i.area_code.length&&(s=[i.area_code.substr(0,2)+"0000",i.area_code.substr(0,4)+"00",i.area_code],this.setState({areaPickerData:o})),(o=[])[0]=r[0].filter(function(){return!0}),i&&6===i.area_code.length&&(d[0]=o[0].findIndex(function(e){return e.code===s[0]})),o[1]=r[1].filter(function(e){return e.code.substr(0,2)===o[0][d[0]].code.substr(0,2)}),i&&6===i.area_code.length&&(d[1]=o[1].findIndex(function(e){return e.code===s[1]})),o[2]=r[2].filter(function(e){return e.code.substr(0,4)===o[1][d[1]].code.substr(0,4)}),i&&6===i.area_code.length&&(d[2]=o[2].findIndex(function(e){return e.code===s[2]}),this.setState({checkedArea:d}))}else 0===e?(o[1]=r[1].filter(function(e){return e.code.substr(0,2)===o[0][t].code.substr(0,2)}),o[2]=r[2].filter(function(e){return e.code.substr(0,4)===o[1][0].code.substr(0,4)}),0===o[2].length&&(o[2]=o[1][0].name)):1===e&&(o[2]=r[2].filter(function(e){return e.code.substr(0,4)===o[1][t].code.substr(0,4)}),0===o[2].length&&(o[2]=o[1][t].name));if(this.setState({areaPickerData:o}),n)return o}},{key:"_createData",value:function(){this.__state=arguments[0]||this.state||{},this.__props=arguments[1]||this.props||{};arguments[2];var e=this.$prefix,t=(0,_index.genCompid)(e+"$compid__55"),a=this.__state,n=a.addressInfo,r=a.areaText,o=a.areaPickerData,i=(a.checkedArea,Boolean(this.$router.params.choose)),s=Boolean((0,_globalData.getGlobalData)("address"));r.length,o||_index.propsManager.set({type:"inline"},t);n&&n.status;var d="WEAPP"===_index2.default.getEnv();return Object.assign(this.__state,{anonymousState__temp:d,$compid__55:t,isChoose:i,isEdit:s}),this.__state}}]),o}(),_class.$$events=["handleAreaColumnChange","handleAreaChange","onSetDefault","onDelete","handleClickImport","handleSave","onUpdateForm"],_class.$$componentPath="pages/edit-address/edit-address",_temp2);exports.default=EditAddress,Component(require("../../npm/@tarojs/taro-weapp/index.js").default.createComponent(EditAddress,!0));