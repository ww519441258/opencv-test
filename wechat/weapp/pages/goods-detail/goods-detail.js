"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _class,_temp2,_createClass=function(){function i(e,t){for(var o=0;o<t.length;o++){var i=t[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,o){return t&&i(e.prototype,t),o&&i(e,o),e}}(),_get=function e(t,o,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,o);if(void 0===n){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,o,i)}if("value"in n)return n.value;var s=n.get;return void 0!==s?s.call(i):void 0},_index=require("../../npm/@tarojs/taro-weapp/index.js"),_index2=_interopRequireDefault(_index),_ajax=require("../../utils/ajax.js"),_ajax2=_interopRequireDefault(_ajax),_globalData=require("../../utils/global-data.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var GoodsDetail=(_temp2=_class=function(e){function s(){var e,t,i;_classCallCheck(this,s);for(var o=arguments.length,n=Array(o),a=0;a<o;a++)n[a]=arguments[a];return(t=i=_possibleConstructorReturn(this,(e=s.__proto__||Object.getPrototypeOf(s)).call.apply(e,[this].concat(n)))).$usedState=["_$anonymousState__temp","_$anonymousState__temp2","_$anonymousState__temp3","_$anonymousState__temp4","_$anonymousState__temp5","goodsInfo","$compid__16","$compid__17","$compid__18","$compid__19","$compid__20","$compid__21","$compid__22","$compid__23","$compid__24","$compid__25","$compid__26","$compid__27","$compid__28","$compid__29","$compid__30","$compid__31","$compid__32","$compid__33","$compid__34","$compid__35","$compid__36","info","isExchange","isGroupBooking","describe","activityStatus","isNonExist","isShowSku","isStarred","skuButtonType","regimentByShare","activeTab","__fn_on"],i.config={navigationBarTitleText:"商品详情"},i.getData=function(){if("1"===i.$router.params.is_group_booking){var e=i.$router.params,t=e.regiment_id,o=e.id;(0,_ajax2.default)({name:"getGroupBookingGoodsDetail",data:{groupbooking_id:o},success:function(e){(0,_ajax2.default)({name:"queryIsStarred",data:{goods_id:e.info.goods_id},success:function(e){i.setState({isStarred:0<e.status})}}),i.setState({goodsInfo:e})}}),t&&(0,_ajax2.default)({name:"getRegimentInfo",data:{regiment_id:t,groupbooking_id:o},success:function(e){i.setState({regimentByShare:e})}})}else(0,_ajax2.default)({name:"getGoodsDetail",data:{id:i.$router.params.id},success:function(e){(0,_ajax2.default)({name:"queryIsStarred",data:{goods_id:e.info.id},success:function(e){i.setState({isStarred:0<e.status})}}),i.setState({goodsInfo:e})},fail:function(e){-1===e.code&&i.setState({isNonExist:!0})},hideToast:!0})},i.showSku=function(){"1"===i.$router.params.is_exchange?i.setState({isShowSku:!0,skuButtonType:"main"}):i.setState({isShowSku:!0,skuButtonType:"both"})},i.onAddToCart=function(e,t,o){(0,_ajax2.default)({name:"addToCart",data:{id:e,number:t,skuId:o},success:function(){i.hideSku(),_index2.default.eventCenter.trigger("updateCart")},hintText:"加入购物车"})},i.onClickMain=function(e,t,o){"number"==typeof e?"1"===i.$router.params.is_exchange?i.exchange(e,t,o):"join"===i.state.skuButtonType?i.joinGroupBooking(i.currentGroupId,t,o):"1"===i.$router.params.is_group_booking?i.onCreateGroupBooking(e,t,o):i.onPurchase(e,t,o):i.setState({isShowSku:!0,skuButtonType:"main"})},i.exchange=function(e,t,o){(0,_ajax2.default)({name:"submitPointsOrder",data:{goodsId:e,number:t,skuId:o},success:function(e){_index2.default.navigateTo({url:"../order/order?id="+e.orderId+"&is_exchange=1"})},fail:function(e){2===e.code&&(_index2.default.navigateTo({url:"../edit-address/edit-address"}),_index2.default.showToast({title:"当前没有收货地址，请先新建一个收货地址",icon:"none",duration:3e3}))}})},i.onClickMinor=function(e,t,o){"number"==typeof e?"1"===i.$router.params.is_group_booking?i.onPurchase(e,t,o):i.onAddToCart(e,t,o):i.setState({isShowSku:!0,skuButtonType:"minor"})},i.onPurchase=function(e,t,o){(0,_ajax2.default)({name:"purchase",data:{id:e,number:t,skuId:o},success:function(e){_index2.default.navigateTo({url:"../order/order?id="+e.orderId})},fail:function(e){2===e.code&&(_index2.default.navigateTo({url:"../edit-address/edit-address"}),_index2.default.showToast({title:"当前没有收货地址，请先新建一个收货地址",icon:"none",duration:3e3}))}})},i.hideSku=function(){i.setState({isShowSku:!1})},i.goBack=function(){_index2.default.navigateBack()},i.onClickStar=function(){var e=void 0,t=void 0,o=i.state.goodsInfo.info.goods_id||i.state.goodsInfo.info.id;t=0<i.state.isStarred?(e="unstarGoods","取消收藏"):(e="starGoods","收藏"),(0,_ajax2.default)({name:e,data:{goods_id:o},success:function(){i.setState({isStarred:!i.state.isStarred})},hintText:t})},i.onChangeTab=function(e){e!==i.state.activeTab&&(i.setState({activeTab:e}),1===e&&_index2.default.eventCenter.trigger("reload:goodsCommentList","getGoodsComment",{goods_id:i.state.goodsInfo.info.id}))},i.onCreateGroupBooking=function(e,t,o){(0,_ajax2.default)({name:"createGroupBooking",data:{groupbooking_id:i.state.goodsInfo.info.groupbooking_id,number:t,sku_id:o},success:function(e){_index2.default.navigateTo({url:"../order/order?id="+e.order_id})}})},i.onShowSkuForJoin=function(e){i.currentGroupId=e,i.setState({isShowSku:!0,skuButtonType:"join"})},i.joinGroupBooking=function(e,t,o){(0,_ajax2.default)({name:"joinGroupBooking",data:{regiment_id:e,groupbooking_id:i.state.goodsInfo.info.groupbooking_id,number:t,sku_id:o},success:function(e){_index2.default.navigateTo({url:"../order/order?id="+e.order_id})}})},i.onUpdatePrice=function(e){i.setState({activityStatus:e})},i.customComponents=["Price","ActionBar","LeftOfActionBar","ActivityBar","GroupBooking","Cell","AtTabs","AtTabsPane","RichTextPro","Tip","Comment","Sku","Loading"],_possibleConstructorReturn(i,t)}return _inherits(s,_index.Component),_createClass(s,[{key:"_constructor",value:function(e){_get(s.prototype.__proto__||Object.getPrototypeOf(s.prototype),"_constructor",this).call(this,e),this.hasChoose=!1,this.currentGroupId=-1,this.state={goodsInfo:null,isNonExist:!1,isShowSku:!1,isStarred:!1,skuButtonType:"",regimentByShare:null,activeTab:0,activityStatus:""},this.$$refs=[]}},{key:"componentWillMount",value:function(){var e=this;(0,_globalData.setGlobalData)("submittedCartIds",[]),_index2.default.eventCenter.on("update:goodsDetail",function(){e.getData()}),this.getData()}},{key:"onShareAppMessage",value:function(){var e=this.state.goodsInfo.info,t=e.goods_name,o=e.setmaxuser,i=e.commodity_price,n=e.shop_price,a="1"===this.$router.params.is_group_booking,s=void 0,r="";if(a&&(r="（原价￥"+n+"）"),a){var d="（"+o+"人拼团价 ￥"+i+"）";s="拼团价￥"+i+" | "+(0<=t.indexOf("人拼团")?t.replace(/（.人?拼团价?.*）/,d):t)+r}else s="￥"+n+" | "+t+r;return{title:s}}},{key:"onPullDownRefresh",value:function(){this.componentWillMount()}},{key:"onReachBottom",value:function(){1===this.state.activeTab&&_index2.default.eventCenter.trigger("load:goodsCommentList")}},{key:"_createData",value:function(){var e,t,o,i,n;this.__state=arguments[0]||this.state||{},this.__props=arguments[1]||this.props||{};arguments[2];var a=this.$prefix,s=(0,_index.genCompid)(a+"$compid__16"),r=(0,_index.genCompid)(a+"$compid__17"),d=(0,_index.genCompid)(a+"$compid__18"),_=(0,_index.genCompid)(a+"$compid__19"),c=(0,_index.genCompid)(a+"$compid__20"),u=(0,_index.genCompid)(a+"$compid__21"),p=(0,_index.genCompid)(a+"$compid__22"),m=(0,_index.genCompid)(a+"$compid__23"),l=(0,_index.genCompid)(a+"$compid__24"),g=(0,_index.genCompid)(a+"$compid__25"),f=(0,_index.genCompid)(a+"$compid__26"),h=(0,_index.genCompid)(a+"$compid__27"),k=(0,_index.genCompid)(a+"$compid__28"),x=(0,_index.genCompid)(a+"$compid__29"),S=(0,_index.genCompid)(a+"$compid__30"),$=(0,_index.genCompid)(a+"$compid__31"),C=(0,_index.genCompid)(a+"$compid__32"),y=(0,_index.genCompid)(a+"$compid__33"),b=(0,_index.genCompid)(a+"$compid__34"),v=(0,_index.genCompid)(a+"$compid__35"),T=(0,_index.genCompid)(a+"$compid__36"),B=this.__state,M=B.goodsInfo,j=B.activityStatus,w=B.regimentByShare,I=B.isShowSku,P=B.isStarred,G=B.buttonType,O=M&&M.info,D="1"===this.$router.params.is_exchange,E="1"===this.$router.params.is_group_booking,R=O&&O.goods_desc,A=void 0,q=void 0;q=E&&M?(A="￥"+M.info.commodity_price+" 我要开团","￥"+M.info.shop_price+" 单独购买"):(A=D?"立即兑换":"立即购买","加入购物车");var L=void 0,F=void 0;return"both"===this.__state.skuButtonType?(L=A,F=q):"main"===this.__state.skuButtonType?(L=A,F=""):"minor"===this.__state.skuButtonType?(L="",F=q):"join"===this.__state.skuButtonType&&(L="确认参团",F=""),M&&O?(O.stock,"start"===j?_index.propsManager.set({price:M.seckillTime.price,marketPrice:M.info.market_price},s):M.info.commodity_price?_index.propsManager.set({price:M.info.commodity_price,marketPrice:M.info.shop_price||M.info.market_price},r):_index.propsManager.set({price:M.info.shop_price,marketPrice:M.info.market_price},d),D?(e=0===O.stock,_index.propsManager.set({type:"custom",fixed:!0,hideNav:!0,isButtonFill:!0,disabled:e,mainButton:"立即兑换",onClickMain:this.onClickMain},c),_index.propsManager.set({isStarred:P,onClickStar:this.onClickStar},u)):E?(t=0===O.stock,_index.propsManager.set({type:"custom",fixed:!0,isButtonFill:!0,disabled:t,isStarred:this.__state.isStarred,mainButton:A,minorButton:q,onClickMain:this.onClickMain,onClickMinor:this.onClickMinor,onClickStar:this.onClickStar},p),_index.propsManager.set({isStarred:P,onClickStar:this.onClickStar},m)):(o=0===O.stock,_index.propsManager.set({type:"custom",fixed:!0,isButtonFill:!0,disabled:o,isStarred:this.__state.isStarred,mainButton:"立即购买",minorButton:"加入购物车",onClickMain:this.onClickMain,onClickMinor:this.onClickMinor,onClickStar:this.onClickStar},l),_index.propsManager.set({isStarred:P,onClickStar:this.onClickStar},g)),i=0===O.stock,n=[{title:"商品详情"},{title:"商品评论"}],D&&_index.propsManager.set({price:M.info.points,isExchange:!0},_),M.seckillTime&&0===!M.seckillTime.length&&!D&&_index.propsManager.set({activity:M.seckillTime,type:"secKill",onUpdatePrice:this.onUpdatePrice},f),E&&_index.propsManager.set({goodsInfo:M,regimentId:this.$router.params.regiment_id,onShowSkuForJoin:this.onShowSkuForJoin,regimentByShare:w},h),_index.propsManager.set({icon:"choose-type",title:"请选择规格类型数量",disabled:i,onClick:this.showSku.bind(void 0,"goodsWithoutLeft"),isLink:!0},k),_index.propsManager.set({current:this.__state.activeTab,tabList:n,onClick:this.onChangeTab,swipeable:!1},x),_index.propsManager.set({current:this.__state.activeTab,index:0},S),R&&_index.propsManager.set({nodes:R,horizontalPadding:0},$),!R&&_index.propsManager.set({text:"该商品没有详情信息",mainActionType:"none"},C),_index.propsManager.set({current:this.__state.activeTab,index:1},y),_index.propsManager.set({goodsId:M.info.goods_id||M.info.id},b),_index.propsManager.set({show:I,goodsInfo:O,skuList:M.skuInfo,combination:M.products,mainButton:L,minorButton:F,buttonType:G,onHide:this.hideSku,onClickMinor:this.onClickMinor,onClickMain:this.onClickMain,isExchange:D},v)):this.__state.isNonExist&&_index.propsManager.set({type:"full",text:"该商品不存在或已下架"},T),Object.assign(this.__state,{_$anonymousState__temp:e,_$anonymousState__temp2:t,_$anonymousState__temp3:o,_$anonymousState__temp4:i,_$anonymousState__temp5:n,$compid__16:s,$compid__17:r,$compid__18:d,$compid__19:_,$compid__20:c,$compid__21:u,$compid__22:p,$compid__23:m,$compid__24:l,$compid__25:g,$compid__26:f,$compid__27:h,$compid__28:k,$compid__29:x,$compid__30:S,$compid__31:$,$compid__32:C,$compid__33:y,$compid__34:b,$compid__35:v,$compid__36:T,info:O,isExchange:D,isGroupBooking:E,describe:R}),this.__state}}]),s}(),_class.$$events=[],_class.$$componentPath="pages/goods-detail/goods-detail",_temp2);exports.default=GoodsDetail,Component(require("../../npm/@tarojs/taro-weapp/index.js").default.createComponent(GoodsDetail,!0));