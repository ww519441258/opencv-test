"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _class,_temp2,_extends=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},_createClass=function(){function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}}(),_get=function t(e,n,i){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,n);if(void 0===o){var r=Object.getPrototypeOf(e);return null===r?void 0:t(r,n,i)}if("value"in o)return o.value;var s=o.get;return void 0!==s?s.call(i):void 0},_index=require("../../../npm/@tarojs/taro-weapp/index.js"),_index2=_interopRequireDefault(_index),_index3=require("../../../npm/classnames/index.js"),_index4=_interopRequireDefault(_index3);function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var Index=(_temp2=_class=function(t){function r(){var t,e,l;_classCallCheck(this,r);for(var n=arguments.length,i=Array(n),o=0;o<n;o++)i[o]=arguments[o];return(e=l=_possibleConstructorReturn(this,(t=r.__proto__||Object.getPrototypeOf(r)).call.apply(t,[this].concat(i)))).$usedState=["loopArray35","$compid__142","$compid__143","$compid__144","$compid__145","$compid__146","checkedSku","isGroupBooking","goodsInfo","skuListForRender","show","checkedAttrs","purchaseQuantity","skuList","combination","isExchange","mainButton","__fn_onClick","minorButton","onHide"],l.onClickSku=function(t,e){if(e.disabled)return!1;var n=l.props,i=n.skuList,o=n.combination,r=l.state,s=r.skuListForRender,a=r.checkedAttrs,c=r.purchaseQuantity,u=l.initSkuList,p=null;a[t]===e.id?a[t]=-1:a[t]=e.id;var d=a.filter(function(t){return 0<t});d.length===i.length&&(p=o.find(function(t){return t.attr.every(function(t,e){return t==d[e]})})).stock&&0<=p.stock&&c>p.stock&&(c=p.stock,_index2.default.showToast({title:"此规格库存小于您选择的数量，已重新设置数量",icon:"none",duration:3e3})),s=0<a.filter(function(t){return 0<t}).length?i.map(function(t,s){var e=t.attr.map(function(r){var t=o.find(function(t){var o=!0;return t.attr.forEach(function(t,e){var n=s!==e&&0<a[e]&&a[e]!=t,i=e===s&&r.id!=t;(n||i)&&(o=!1)}),o});return _extends({},r,{disabled:!t})});return _extends({},t,{attr:e})}):JSON.parse(JSON.stringify(u)),l.setState({checkedAttrs:a,skuListForRender:s,purchaseQuantity:c,checkedSku:p})},l.setQuantity=function(t){l.setState({purchaseQuantity:t})},l.onAddToCart=function(){var t=l.state.skuList;if(0===t.length||l.state.checkedSku){var e=l.state.goodsInfo.id,n=l.state.purchaseQuantity,i=0===t.length?0:l.state.checkedSku.id;l.props.onAddToCart(e,n,i)}else _index2.default.showToast({title:"请选择完整的规格",icon:"none"})},l.onClickActionButton=function(t){var e=l.props.skuList;if(0===e.length||l.state.checkedSku){var n=l.props.goodsInfo.id||l.props.goodsInfo.goods_id,i=l.state.purchaseQuantity,o=0===e.length?0:l.state.checkedSku.id;"main"===t?l.props.onClickMain(n,i,o):l.props.onClickMinor(n,i,o)}else _index2.default.showToast({title:"请选择完整的规格",icon:"none"})},l.onClickMain=function(){l.onClickActionButton("main")},l.onClickMinor=function(){l.onClickActionButton("minor")},l.customComponents=["Price","Stepper","ActionBar"],_possibleConstructorReturn(l,e)}return _inherits(r,_index.Component),_createClass(r,[{key:"_constructor",value:function(t){_get(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"_constructor",this).call(this,t);var e=this.props,n=e.skuList,i=e.combination;this.initSkuList=n.map(function(t,n){return _extends({},t,{attr:t.attr.map(function(e){return _extends({},e,{disabled:!i.find(function(t){return t.attr[n]==e.id})})})})}),this.state={skuListForRender:this.initSkuList,checkedAttrs:n.map(function(){return-1}),checkedSku:null,purchaseQuantity:1},this.$$refs=[]}},{key:"componentWillReceiveProps",value:function(t){var e=t.skuList,i=t.combination;this.initSkuList=e.map(function(t,n){return _extends({},t,{attr:t.attr.map(function(e){return _extends({},e,{disabled:!i.find(function(t){return t.attr[n]==e.id})})})})}),this.setState({skuListForRender:this.initSkuList})}},{key:"_createData",value:function(){var o=this;this.__state=arguments[0]||this.state||{},this.__props=arguments[1]||this.props||{};arguments[2];var t=this.$prefix,e=(0,_index.genCompid)(t+"$compid__142"),n=(0,_index.genCompid)(t+"$compid__143"),i=(0,_index.genCompid)(t+"$compid__144"),r=(0,_index.genCompid)(t+"$compid__145"),s=(0,_index.genCompid)(t+"$compid__146"),a=void 0,c=this.__props,u=c.show,p=c.isExchange,d=c.mainButton,l=c.goodsInfo,_=this.__state,f=_.skuListForRender,h=_.checkedSku,k=void 0,m=void 0,g=!1;return(d&&d.includes("我要开团")||"确认参团"===d)&&(g=!0),f&&(k=0<(m=l.limit_count)?h&&0<h.stock?Math.min(m,h.stock):0<l.stock?Math.min(m,l.stock):m:h&&0<h.stock?h.stock:0<l.stock?l.stock:void 0,h?_index.propsManager.set({price:h.price},e):g?_index.propsManager.set({price:l.commodity_price,marketPrice:l.shop_price},n):_index.propsManager.set({price:p?l.points:l.shop_price,marketPrice:p?void 0:l.market_price,isExchange:p},i),(h?-1===h.stock:-1===l.stock)||h&&0<h.stock||0<l.stock||null,a=f.map(function(t,i){return{$anonymousCallee__3:(t={$original:(0,_index.internal_get_original)(t)}).$original.attr.map(function(t,e){t={$original:(0,_index.internal_get_original)(t)};var n=o.__state.checkedAttrs;return{className:(0,_index4.default)({checked:n[i]&&n[i]===t.$original.id,disabled:t.$original.disabled}),$original:t.$original}}),$original:t.$original}}),_index.propsManager.set({value:this.__state.purchaseQuantity,max:k,min:1,onChange:this.setQuantity},r),_index.propsManager.set({noFixed:!0,hideNav:!0,isButtonFill:!0,mainButton:this.__props.mainButton,minorButton:this.__props.minorButton,onClickMain:this.onClickMain,onClickMinor:this.onClickMinor},s)),Object.assign(this.__state,{loopArray35:a,$compid__142:e,$compid__143:n,$compid__144:i,$compid__145:r,$compid__146:s,isGroupBooking:g,goodsInfo:l,show:u}),this.__state}},{key:"funPrivateNbINj",value:function(){return this.props.onHide.apply(void 0,Array.prototype.slice.call(arguments,1))}}]),r}(),_class.$$events=["funPrivateNbINj","onClickSku"],_class.defaultProps={show:!1,goodsInfo:{},skuList:[],combination:[],onHide:function(){},onAddToCart:function(){},onPurchase:function(){}},_class.$$componentPath="pages/goods-detail/Sku/index",_temp2);exports.default=Index,Component(require("../../../npm/@tarojs/taro-weapp/index.js").default.createComponent(Index));