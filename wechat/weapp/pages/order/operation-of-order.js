"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.buyAgain=exports.comment=exports.cancelRefund=exports.refund=exports.confirmReceive=exports.showQRCodeForVerifying=exports.viewExpressInfo=exports.pay=exports.cancel=exports.exchange=exports.confirm=void 0;var _extends=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},confirm=exports.confirm=function(){var t=_asyncToGenerator(regeneratorRuntime.mark(function e(r,t){var n,a,i=t.coupon,o=t.name,u=t.tel,s=t.postscript;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=(0,_globalData.getGlobalData)("submittedCartIds")||[],a=1===r.shipping_type?{siteId:r.picking_site.id}:{},e.next=4,(0,_ajax2.default)({name:"confirmOrder",data:_extends({id:r.id,coupon_id:i?i.id:0,cartIds:n,postscript:s,name:o,mobile:u},a)});case 4:if("积分兑换订单"===(0,_orderStatus.getOrderType)(r))return e.next=7,exchange(r);e.next=10;break;case 7:_index2.default.eventCenter.trigger("update:order"),e.next=15;break;case 10:(0,_globalData.setGlobalData)("submittedCartIds",[]),_index2.default.eventCenter.trigger("update:orderList"),i&&_index2.default.eventCenter.trigger("update:userCenter"),n&&0<n.length&&_index2.default.eventCenter.trigger("updateCart"),_index2.default.eventCenter.trigger("updateAndPay:"+r.id);case 15:case"end":return e.stop()}},e,this)}));return function(e,r){return t.apply(this,arguments)}}(),exchange=exports.exchange=function(){var r=_asyncToGenerator(regeneratorRuntime.mark(function e(r){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,_ajax2.default)({name:"exchangePointsOrder",data:{orderId:r.id,env:"WEB"===_index2.default.getEnv()?1:2}});case 2:_index2.default.eventCenter.trigger("update:order"),_index2.default.eventCenter.trigger("update:orderList"),(0,_globalData.setGlobalData)("submittedCartIds",[]);case 5:case"end":return e.stop()}},e,this)}));return function(e){return r.apply(this,arguments)}}(),cancel=exports.cancel=function(){var r=_asyncToGenerator(regeneratorRuntime.mark(function e(r){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,_ajax2.default)({name:"cancelOrder",data:{id:r.id}});case 2:_index2.default.eventCenter.trigger("reload:orderList"),_index2.default.navigateBack(),_index2.default.showToast({title:"取消订单成功"});case 5:case"end":return e.stop()}},e,this)}));return function(e){return r.apply(this,arguments)}}(),pay=exports.pay=function(){var r=_asyncToGenerator(regeneratorRuntime.mark(function e(r){var t,n,a,i,o,u;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=r.order,n=r.userMsg,i=(a=t||r).id,o=a.pay_fee,u=(n||{}).balances,_index2.default.navigateTo({url:"/pages/pay/pay?orderId="+i+"&amount="+o+(u?"&balance="+u:"")});case 4:case"end":return e.stop()}},e,this)}));return function(e){return r.apply(this,arguments)}}(),viewExpressInfo=exports.viewExpressInfo=function(){var r=_asyncToGenerator(regeneratorRuntime.mark(function e(r){var t,n,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=r.order,n=r.express,a=(t||r).id,n&&_index2.default.setStorageSync("expressInfo",n),_index2.default.navigateTo({url:"/pages/express-info/express-info?orderId="+a});case 4:case"end":return e.stop()}},e,this)}));return function(e){return r.apply(this,arguments)}}(),showQRCodeForVerifying=exports.showQRCodeForVerifying=function(){var r=_asyncToGenerator(regeneratorRuntime.mark(function e(r){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=(r.order||r).verifier_qrcode)return e.abrupt("return",_index2.default.previewImage({urls:[t]}));e.next=5;break;case 5:return e.abrupt("return",(0,_helper.showError)("订单数据异常"));case 6:case"end":return e.stop()}},e,this)}));return function(e){return r.apply(this,arguments)}}(),confirmReceive=exports.confirmReceive=function(){var r=_asyncToGenerator(regeneratorRuntime.mark(function e(r){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,_index2.default.showModal({title:"确认收货",content:"确定已经收到商品吗?"});case 2:if(e.sent.confirm)return e.next=6,(0,_ajax2.default)({name:"confirmReceive",data:{id:r.id},hintText:"确认收货"});e.next=9;break;case 6:_index2.default.eventCenter.trigger("update:order"),_index2.default.eventCenter.trigger("update:orderList"),_index2.default.eventCenter.trigger("update:userCenter");case 9:case"end":return e.stop()}},e,this)}));return function(e){return r.apply(this,arguments)}}(),refund=exports.refund=function(){var r=_asyncToGenerator(regeneratorRuntime.mark(function e(r){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:_index2.default.navigateTo({url:"/pages/refund/refund?orderId="+r.id});case 1:case"end":return e.stop()}},e,this)}));return function(e){return r.apply(this,arguments)}}(),cancelRefund=exports.cancelRefund=function(){var r=_asyncToGenerator(regeneratorRuntime.mark(function e(r){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,_ajax2.default)({name:"cancelRefund",data:{id:r.id},hintText:"取消退款"});case 2:_index2.default.eventCenter.trigger("update:order"),_index2.default.eventCenter.trigger("update:orderList"),_index2.default.eventCenter.trigger("update:userCenter");case 5:case"end":return e.stop()}},e,this)}));return function(e){return r.apply(this,arguments)}}(),comment=exports.comment=function(){var r=_asyncToGenerator(regeneratorRuntime.mark(function e(r){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:_index2.default.navigateTo({url:"/pages/comment/comment?ordergoods_id="+r.id});case 1:case"end":return e.stop()}},e,this)}));return function(e){return r.apply(this,arguments)}}(),buyAgain=exports.buyAgain=function(){var r=_asyncToGenerator(regeneratorRuntime.mark(function e(r){var t,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,_ajax2.default)({name:"buyAgain",data:{id:r.id}});case 2:t=e.sent,n=t.cartIds,_index2.default.eventCenter.trigger("updateCart"),_index2.default.setStorageSync("checkedIdsForBuyAgain",n),_index2.default.switchTab({url:"/pages/cart/cart"});case 7:case"end":return e.stop()}},e,this)}));return function(e){return r.apply(this,arguments)}}(),_index=require("../../npm/@tarojs/taro-weapp/index.js"),_index2=_interopRequireDefault(_index),_ajax=require("../../utils/ajax.js"),_ajax2=_interopRequireDefault(_ajax),_globalData=require("../../utils/global-data.js"),_orderStatus=require("./order-status.js"),_helper=require("../../utils/helper.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _asyncToGenerator(e){return function(){var u=e.apply(this,arguments);return new Promise(function(i,o){return function r(e,t){try{var n=u[e](t),a=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(a).then(function(e){r("next",e)},function(e){r("throw",e)});i(a)}("next")})}}